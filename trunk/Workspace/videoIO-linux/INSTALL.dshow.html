<html>
<head>
<title>Installing videoIO on Windows</title>
<link rel="stylesheet" href="doc/videoio.css" type="text/css"></link>
<script type="text/javascript">
  var os     = "all";
  var matlab = "all";
  var vs     = "all";
  
  function isXp()          { return os=='xp32'    || os=='xp64'; }
  function mightBeXp()     { return os=='xp32'    || os=='xp64'    || os=='all'; }
  function isVista()       { return os=='vista32' || os=='vista64'; }
  function mightBeVista()  { return os=='vista32' || os=='vista64' || os=='all'; }
  function mightBeWin32()  { return os=='vista32' || os=='xp32'    || os=='all'; }
  function mightBeWin64()  { return os=='vista64' || os=='xp64'    || os=='all'; }
  
  function mightBeMat32()  { return matlab=='mat32' || matlab=='all'; }
  function mightBeMat64()  { return matlab=='mat64' || matlab=='all'; }
  
  function mightBeVs2003() { return vs=='vs2003' || vs=='all'; }
  function mightBeVs2005() { return vs=='vs2005' || vs=='all'; }
  function mightBeVs2008() { return vs=='vs2008' || vs=='all'; }

  function updateVisElm(self,visstyle) {
    var cond   = self.getAttribute('cond');
    var doshow = eval(cond);
    if (doshow) {
      self.style.display    = visstyle;
    } else {
      self.style.display    = 'none';
    }
  }
  
  function updateVisibilityForATag(tagname,visstyle) {
    var elms = document.getElementsByTagName(tagname);
    for (var i=0; i<elms.length; i++) {
      if ("vis" == elms[i].id) {
        updateVisElm(elms[i],visstyle);
      }
    }  
  }
  
  function updateVisibility() {
    updateVisibilityForATag('p',    'block');
    updateVisibilityForATag('div',  'block');
    updateVisibilityForATag('span', 'inline');
  }
  
  function onChange() {
    // extract checkbox values
    for (var i=0; i<document.forms[0].elements.length; i++) {
      var elm = document.forms[0].elements[i];
      if (elm.checked) {
        eval(elm.name + "='" + elm.value + "'");
      }
    }
    // update display attributes
    updateVisibility();
  }
</script>
</head>

<body onload="onChange()">

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h1>Installing videoIO on Windows</h1>

<a href="http://sourceforge.net/projects/videoio">videoIO</a> is a library 
written by <a href="http://people.csail.mit.edu/dalleyg/">Gerald Dalley</a> 
designed to allow easy and efficient reading and
writing of video files in Matlab on Windows and Linux.  It is designed to 
enhance and/or complement other options that are available as of February
2008.  

<p>This file describes how to set up the videoIO toolbox on a 32-bit or 64-bit 
Windows platform.  See <a href="README.txt">README.txt</a> for a more general 
description of this library and tips on using it.&nbsp;&nbsp; See
<a href="INSTALL.ffmpeg.txt">INSTALL.ffmpeg.txt</a> for GNU/Linux installation 
instructions.

<p>If you are (a) using Windows XP, Windows Server 2003, or Windows Vista,
(b) using Matlab 2007a or later, and (c) have downloaded a videoIO package
that already includes prepackaged binary .mex* files, you may skip to the 
<a href="#matpath">Matlab Path</a> section.&nbsp;  If you experience any 
problems running the basic tests or if you wish to build the library from 
its source, read this whole document.&nbsp; You must download the full 
videoIO package to build the library from source.&nbsp; If you downloaded 
a .zip file with "Bin" in its name, you have the wrong .zip file.

<noscript>
<p><b>Javascript appears to be disabled in your browser.  If you use a 
Javascript-enabled browser and enable Javascript, this document will 
auto-adjust to the machine configuration you specify.
</b></p>
</noscript>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2>Contents</h2>
<ul>
<li class="tight"><a href="#prereq">Prerequisites Overview</a></li>
<li class="tight"><a href="#env">Environment Variables</a></li>
<li class="tight"><a href="#osupdates">Operating System Updates</a></li>
<li class="tight"><a href="#vs">Visual Studio</a></li>
<li class="tight"><a href="#windowssdk">Windows SDK</a></li>
<li class="tight"><a href="#platformsdk">Platform SDK</a></li>
<li class="tight"><a href="#dxsdk">DirectX SDK</a></li>
<li class="tight"><a href="#building">Building the Library</a></li>
<li class="tight"><a href="#matpath">Matlab Path</a></li>
<li class="tight"><a href="#testing">Testing</a></li>
<li class="tight"><a href="#usage">Usage</a></li>
</ul>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2><a name="prereq"></a>Prerequisites Overview</h2>
<div class="quick">Quick: at least skim all of this section.  Select 
appropriate radio buttons to simplify the rest of the document.</div>

<div class="quick">Reminder: if you downloaded a package with "windowsBin" in
its name, skip to the <a href="#matpath">Matlab Path</a> section.&nbsp;
To rebuild videoIO, you must download a "source" package or check out the
subversion respository.</div>

This installation procedure has been tested with a number of different 
configurations.  All supported combinations are given below.  To remove steps 
that do not apply to your computer, select the closest matches to your system.

<br/><br/>
<form name="selform">
<table>
  <tr>
    <td colspan="2"><h3>Knowledge</h3></td>
  </tr>
  <tr>
    <td>
    </td>
    <td class="expl">
      We assume you have at least a passing familiarity with compiling
      C/C++ programs and that you know what environment variables are (or 
      can <a href="#env">follow directions</a> exactly).
    </td>
  </tr>

  <tr>
    <td colspan="2"><h3>Operating System</h3></td>
  </tr>
  <tr>
    <td>
      <nobr><input type="radio" name="os" onchange="onChange()" value="xp32">Windows XP Pro 32-bit</input> </nobr><br/>
      <nobr><input type="radio" name="os" onchange="onChange()" value="xp64">Windows XP Pro 64-bit</input> (untested) </nobr><br/>
      <nobr><input type="radio" name="os" onchange="onChange()" value="vista32">Windows Vista 32-bit</input> (untested) </nobr><br/>
      <nobr><input type="radio" name="os" onchange="onChange()" value="vista64">Windows Vista 64-bit</input> </nobr><br/>
      <nobr><input type="radio" name="os" onchange="onChange()" value="all" checked="checked">Show all</input> </nobr>
    </td>
    <td class="expl">
      You will probably need administrative privileges to install the 3rd 
      party libraries. 

      <p>The videoIO toolbox should work without modification on any version of 
      Vista, on 64-bit XP Pro, and on any version of Windows Server 2003.  It should 
      work with Win2k+, maybe even Win95.  To try it out, you'll need to modify 
      the <tt>WINVER</tt> macro in a few source files.  

      <p>If you use 64-bit Windows and 64-bit Matlab, you can only use 
      64-bit codecs.  If you use 32-bit Matlab (on either 32-bit or 64-bit 
      Windows), you can only use 32-bit codecs.
      
      <p>We assume the user has already installed the desired operating system.</p>
    </td>
  </tr>

  <tr>
    <td colspan="2"><h3>Matlab</h3></td>
  </tr>
  <tr>
    <td>
      <nobr><input type="radio" name="matlab" onchange="onChange()" value="mat32"></input>32-bit Matlab (R2006a or later) </nobr><br/>
      <nobr><input type="radio" name="matlab" onchange="onChange()" value="mat64"></input>64-bit Matlab (R2006a or later) </nobr><br/>
      <nobr><input type="radio" name="matlab" onchange="onChange()" value="all" checked="checked">Show all</input> </nobr>
    </td>
    <td class="expl">
      videoIO should work on Matlab 6.5 or later, but it has not been tested.

      <p>Reminder: If you use 64-bit Matlab, you can only use 64-bit codecs
      (and 32-bit Matlab can only use 32-bit codecs).
      
      <p>We assume the user has already installed Matlab.</p>
    </td>
  </tr>

  <tr>
    <td colspan="2"><h3>Compiler</h3></td>
  </tr>
  <tr>
    <td>
      <nobr><input type="radio" name="vs" onchange="onChange()" value="vs2003"></input>Microsoft Visual Studio 2003 </nobr><br/>
      <nobr><input type="radio" name="vs" onchange="onChange()" value="vs2005"></input>Microsoft Visual Studio 2005 </nobr><br/>
      <input type="radio" name="vs" onchange="onChange()" value="vs2008"></input>Microsoft Visual Studio 2008<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(untested) <br/>      
      <nobr><input type="radio" name="vs" onchange="onChange()" value="all" checked="checked">Show all</input> </nobr>
    </td>
    <td class="expl">
      videoIO may work on Visual Studio 6.  It will probably not work with even 
      older versions.  Let us know if you get it to work with an older version
      or if you get it to work with the Express editions.
      
      <p>Visual Studio 2003 has not been tested for 64-bit builds.</p>
      
      <p><a href="#vs">Installation and configuration</a> instructions are given below.</p>
    </td>
  </tr>

  <tr>
    <a name="winsdksel"></a>
    <td colspan="2"><h3>SDKs from Microsoft</h3></td>
  </tr>
  <tr>
    <td>
      <ul class="left">
        <span cond="mightBeXp()" id="vis"><li class="tight"><nobr>Microsoft Windows SDK 
          <span cond="mightBeVista()" id="vis"><br/><em>(for Vista only)</em></span></nobr></li></span>
        <span cond="mightBeVista()" id="vis"><li class="tight">Microsoft Windows Server<br/>
          2003 R2 Platform SDK <span cond="mightBeXp()" id="vis"><br/><em>(for XP and 2003 only)</em></span></li></span>
        <li>Microsoft DirectX SDK</li>
      </ul>
    </td>
    <td class="expl">
      <p cond="os=='all'" id="vis">
      If you are using Vista, you need the "Windows SDK", not the "Platform 
      SDK".  XP and Server 2003 need the Platform SDK instead.</p>
      
      <p cond="mightBeXp()" id="vis">
      Make sure you use the latest version of the Platform SDK (R2 as of 
      February 2008).  Older versions require manually fixing some compiler 
      incompatibilities in Microsoft's source code.  
      </p>
      
      <p>These SDKs provide important libraries for communicating with 
      DirectShow.  Detailed installation instructions are given below.</p>
      
      <p>
        Installation instructions for 
        <span cond="mightBeXp()" id="vis">the <a href="#platformsdk">Platform SDK</a>, </span>
        <span cond="mightBeVista()" id="vis">the <a href="#windowssdk">Windows SDK</a>, </span>
        and the <a href="#dxsdk">DirectX SDK</a> are given below.
      </p>
    </td>
  </tr>

  <tr>
    <td colspan="2"><h3>Codecs and Other DirectShow Components</h3></td>
  </tr>
  <tr>
    <td>
      <ul class="left">
        <li class="tight">Windows Media 9 codec</li>
        <li class="tight">An MPEG4 codec such as:<ul class="left">
        <li class="tight">DivX, </li>
		<li class="tight">XviD, </li>
		<li class="tight">3ivx, or </li>
		<li class="tight">ffdshow</li>
      </ul>
    	</li>
        <li class="tight">An H264-compatible codec such as:<ul class="left">
        <li class="tight">x264 (writing only), </li>
		<li class="tight">ffdshow (reading and writing), or </li>
		<li class="tight">CoreAVC 
		Professional </li>
      </ul>
    	<li class="tight">Haali Media Splitter</li>
      </ul>
    </td>
    <td class="expl">
      <p>DirectShow provides a platform for encoders and decoders (codecs). 
      To encode or decode a particular video file, one must have the appropriate
      codec installed.  Given a compression ratio, modern MPEG4 and H264 codecs 
      can be fast and produce much higher quality results relative to 
      older codecs.  The Windows Media 9 codec family is a set of codecs that
      are proprietary Microsoft adaptations of MPEG4 and H264.
    
      <p>Use <a href="http://update.microsoft.com">Windows Update</a> to 
      obtain the most recent version of Windows Media Player.  The Windows 
      Media 9 (wmv3) codec will installed automatically.  This codec is needed for 
      some tests, but otherwise is not necessary for using the library.
 
      <p>Like Windows Media 9, the MPEG4 and H264 codecs are not strictly 
      necessary, but some tests will softly fail if they are not installed.&nbsp; Here are some places to go for fully legal codecs (as of February
      2008):

      <ul>
        <li class="tight"><a href="http://ffdshow-tryout.sourceforge.net/">ffdshow-tryouts</a> (Free one-stop shopping meta 
		codec)</li>
        <li class="tight"><a href="http://www.xvid.org/">XviD</a> (Free MPEG4 
		codec)</li>
        <li class="tight"><a href="http://www.videolan.org/developers/x264.html">x264</a> (Free H.264 
		encoding)</li>
		<li class="tight"><a href="http://www.corecodec.com/">CoreAVC 
		Professional</a> (inexpensive, high-quality commercial H.264 decoder)</li>
        <li class="tight"><a href="http://www.divx.com/">DivX</a> (commercial MPEG4)</li>
        <li class="tight"><a href="http://www.3ivx.com/">3ivx</a> (commercial MPEG4)</li>
      </ul>

      <p>Note that ffdshow-tryout actually supplies a very large set of codecs 
      (including Windows Media 9, MPEG4, H264, and others)
      with intelligent encoding defaults.&nbsp; This is especially useful on 
      64-bit platforms since there are few other 64-bit codecs available 
      (as of February 2008).
    	<p>If you wish to decode videos in non-AVI containers (e.g. .mp4, .ts, .mts, 
		.m2ts, .mkv, .ogg, etc.), consider installing the
		<a href="http://haali.cs.msu.ru/mkv/">Haali Media Splitter</a> as well.&nbsp; 
		If you will be working with 24pf AVCHD or MPEG2 videos, you may wish to 
		read our <a href="doc/pulldownRemoval.html">pulldown removal document</a> 
		after installing videoIO.&nbsp; As of April 2008, the Haali splitter is 
		only available for 32-bit applications.</td>
  </tr>
</table>
</form>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2><a name="env"></a>Environment Variables</h2>
<div class="quick">Quick: carefully follow all of these instructions.</div>

<p>If you do not know what environment variables are or how to permanently 
change them in Windows, see <a href="FAQ.txt">FAQ.txt</a>.

<div cond="os=='all'" id="vis">
<p>In the instructions below, 
    <ul>
      <li class="tight">For 32-bit Windows (XP, Server 2003, or Vista):
        <ul><li class="tight">omit "<tt> (x86)</tt>" from any paths below</li></ul>
      </li>
      <li class="tight">For Windows XP and Windows Server 2003: 
        <ul><li class="tight">skip any individual paths below that mention "Microsoft SDKs"</li></ul>
      </li>
      <li class="tight">For Windows Vista: 
        <ul><li class="tight">skip any individual paths below that mention "Microsoft Platform SDK"</li></ul>
      </li>
    </ul>
<p>Alternatively, return to the <a href="#prereq">prerequisites</a> section
of this document and select the configuration options you'll be using.  If
you use an HTML4-compatible browser with JavaScript enabled, this document
will self-customize to your configuration.
</div>

<p>In these instructions, some directories will need to be added to various 
environment variables.  Many of these folders will not exist until later in the
instructions; however, we will modify all of the environment variables now.
This makes the installation process faster and less complex.

<h4>INCLUDE</h4>

<p>Create the "<tt>INCLUDE</tt>" system environment variable (if it does not 
already exist) and add the following paths to it.  

  <blockquote>
    <div cond="mightBeXp()" id="vis"><tt><nobr>C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Samples\Multimedia\DirectShow\BaseClasses</nobr></tt></div>
    <div cond="mightBeXp()" id="vis"><tt><nobr>C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Include</nobr></tt></div>
    <div cond="mightBeVista()" id="vis"><tt><nobr>C:\Program Files\Microsoft SDKs\Windows\v6.1\Samples\Multimedia\DirectShow\BaseClasses</nobr></tt></div>
    <div cond="mightBeVista()" id="vis"><tt><nobr>C:\Program Files\Microsoft SDKs\Windows\v6.1\Include</nobr></tt></div>
    <div><tt><nobr>%DXSDK_DIR%\Include</nobr></tt></div>
  </blockquote>

<p>When using path-like environment variables on Windows, place a semicolon 
between each string.  For example, if the current <tt>INCLUDE</tt> variable 
is "<tt>C:\foo</tt>" and you wish to add "<tt>C:\bar\baz</tt>", the new 
<tt>INCLUDE</tt> variable will be "<tt>C:\foo;C:\bar\baz</tt>" (without quotes).  
It is important to have no extra spaces before or after the semicolons.
We have placed each path on a separate line in this document for readability
purposes.

<div cond="mightBeXp()" id="vis">
Note: On Windows XP, install the Platform SDK, even though the name might
seem to suggest it requires Server 2003.  The listed Platform SDK is the
correct one for Windows 2000, Windows Server 2003, Windows XP 64-bit, Windows
XP Pro, and Windows XP SP1.</div>

<p>Note: <tt>DXSDK_DIR</tt> is an environment variable which will be created 
when the DirectX SDK is installed.
   
<p>It's important that the include directories be in the order given above (i.e.
the <tt>BaseClasses</tt> directory must appear before the base SDK's 
<tt>Include</tt>, and that before the DirectX's <tt>Include</tt>).  Microsoft 
likes to create stub headers (<tt>.h</tt> files) with the same names as the 
real ones and if the stubs are found first, they break the compilation.

<div cond="mightBeMat32()" id="vis">
<h4>LIB32</h4>

<p>Add the following strings to the "<tt>LIB32</tt>" system environment 
variable<span cond="mightBeMat64()" id="vis"> (you may skip this if you are 
using 64-bit Matlab only)</span>:
  <blockquote>
    <div cond="mightBeXp()" id="vis"><tt><nobr>C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Samples\Multimedia\DirectShow\BaseClasses\WIN2000_RETAIL</nobr></tt></div>
    <div cond="mightBeXp()" id="vis"><tt><nobr>C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Lib</nobr></tt></div>
    <div cond="mightBeVista()" id="vis"><tt><nobr>C:\Program Files\Microsoft SDKs\Windows\v6.1\Samples\Multimedia\DirectShow\BaseClasses\Release</nobr></tt></div>
    <div cond="mightBeVista()" id="vis"><tt><nobr>C:\Program Files\Microsoft SDKs\Windows\v6.1\Lib\x86</nobr></tt></div>
    <div cond="mightBeVista()" id="vis"><tt><nobr>C:\Program Files\Microsoft SDKs\Windows\v6.1\Lib</nobr></tt></div>
  </blockquote>
<p>Order is important here too.</p>
</div>

<div cond="mightBeMat64()" id="vis">
<h4>LIB64</h4>

<p>Add the following strings to the "<tt>LIB64</tt>" system environment 
variable<span cond="mightBeMat32()" id="vis"> (you may skip this if you are using 32-bit Windows)</span>:
  <blockquote>
    <div cond="mightBeXp()" id="vis"><tt><nobr>C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Samples\Multimedia\DirectShow\BaseClasses\WIN2000_RETAIL</nobr></tt></div>
    <div cond="mightBeXp()" id="vis"><tt><nobr>C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Lib</nobr></tt></div>
    <div cond="mightBeVista()" id="vis"><tt><nobr>C:\Program Files\Microsoft SDKs\Windows\v6.1\Samples\Multimedia\DirectShow\BaseClasses\x64\Release</nobr></tt></div>
    <div cond="mightBeVista()" id="vis"><tt><nobr>C:\Program Files\Microsoft SDKs\Windows\v6.1\Lib\x64</nobr></tt></div>
    <div cond="mightBeVista()" id="vis"><tt><nobr>C:\Program Files\Microsoft SDKs\Windows\v6.1\Lib</nobr></tt></div>
  </blockquote>
<p>Order is important here too.
</div>

<p>Add <span cond="vs=='all'" id="vis">the appropriate <em>one</em> of</span> the 
following string<span cond="vs=='all'" id="vis">s</span> to the "<tt>PATH</tt>" system environment 
variable<span cond="os=='all'" id="vis"> (remember to omit "<tt> (x86)</tt>" if you are using 32-bit Windows)</span>.

  <blockquote>
    <div cond="mightBeVs2003()" id="vis"><tt><nobr>C:\Program Files<span cond="mightBeWin64()" id="vis"> (x86)</span>\Microsoft Visual Studio 7\VC\bin</nobr></tt></div>
    <div cond="mightBeVs2005()" id="vis"><tt><nobr>C:\Program Files<span cond="mightBeWin64()" id="vis"> (x86)</span>\Microsoft Visual Studio 8\VC\bin</nobr></tt></div>
    <div cond="mightBeVs2008()" id="vis"><tt><nobr>C:\Program Files<span cond="mightBeWin64()" id="vis"> (x86)</span>\Microsoft Visual Studio 9\VC\bin</nobr></tt></div>
  </blockquote>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<div cond="mightBeVista()" id="vis">
<h2><a name="osupdates"></a>Operating System Updates</h2>
<div class="quick">Quick: Windows Vista users must manually install an OS patch.</div>

Windows Vista unfortunately shipped with a buggy version of a critical function
used to create new AVI files.  If you are using Vista and wish to create videos,
you must manually download and install Microsoft's 
<a href="http://support.microsoft.com/?kbid=939130">KB939130</a> patch.  
  
<p>As of Oct. 2007, this patch must be manually downloaded and installed. It is 
not pushed through Windows Update.  When service pack 1 is released, this (or
an equivalent patch) is expected to be included.

<div cond="mightBeXp()" id="vis">
<p>As far as the authors know, all versions of XP work with this software, 
though we naturally recommend that users regularly update their system using 
<a href="http://update.microsoft.com">Windows Update</a> to avoid security 
risks.
</div>
</div>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2><a name="vs"></a>Visual Studio</h2>
<div class="quick">Quick: Carefully follow all these instructions, even
if you have already installed Visual Studio.</div>

If you want to rebuild the mex binaries, you need a compiler.  The Windows-specific 
portions of this library were written primarily using Visual Studio 2005.  Since 
we do not make extensive use of templates and other advanced C++ features in this 
library, it should work on older versions of Visual Studio, perhaps as far back 
as version 6.  We have not attempted to use Visual Studio Express.  

<p>First, install Visual Studio:
  <ol>
    <li>Purchase Visual Studio</li>
    <li>Use user an account with administrative privileges</li>
    <li>Start the installer;
      <span cond="mightBeMat64()" id="vis">
      if you want to compile 64-bit versions, 
      </span>
      when choosing the custom installation options, check 
        <blockquote>
          Microsoft Visual Studio 2005 Professional &rarr; 
          Language Tools &rarr; 
          Visual C++ &rarr; 
          X64 Compilers and Tools
        </blockquote>
     You may uncheck all .NET and all non C++ options if you want to save 
     space and installation time.  
     <span cond="mightBeVista()" id="vis">If you get an Vista incompatibility 
     warning, ignore it and tell Vista to run the program anyway.</span>
    </li>
  </ol>

<span cond="mightBeVs2005()" id="vis">
If using Visual Studio 2005, download and install Visual Studio 2005 Service 
Pack 1 if you have not already done so via 
<a href="http://update.microsoft.com">Windows Update</a> or 
via <a href="http://msdn.microsoft.com/vstudio/support/vs2005sp1/default.aspx">direct download</a>.  
Installation may take <em>many hours</em>.  Even though you may be tempted to 
skip the service pack installation, install it anyway, especially if you're 
using a single-core, single-processor machine.  Without the service pack, 
Visual Studio has a tendancy to hang for literally <em>minutes</em> at a time.
</span>

<p>Now, we get to configure Visual Studio so it can find the SDKs we'll 
be installing.  As was the case with the <a href="#env">environment variables</a>, 
it's easier to do it all at the same time, so we'll do it now.
In Visual Studio, go to
  <blockquote>
    Tools &rarr; Options... &rarr; Projects and Solutions &rarr; VC++ Directories
  </blockquote>
then
<ol>
  <span cond="mightBeMat32()" id="vis">
    <li>Select "Win32" in the Platform pulldown
      <ol type="a">
        <li>In "Include files", add the following, without quotes: "<tt>$(INCLUDE)</tt>"</li>
        <li>In "Library files", add the following, without quotes: "<tt>$(LIB32)</tt>"</li>
      </ol>
    </li>
  </span>
  <span cond="mightBeMat64()" id="vis">
    <li>Select "x64" in the Platform pulldown 
        <span cond="mightBeMat32()" id="vis">
          (you may skip this step if you are using 32-bit Windows or are only using 32-bit Matlab)
        </span>
      <ol type="a">
        <li>In "Include files", add the following, without quotes: "<tt>$(INCLUDE)</tt>"</li>
        <li>In "Library files", add the following, without quotes: "<tt>$(LIB64)</tt>"</li>
      </ol>
    </li>
  </span>
</ol>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<div cond="mightBeVista()" id="vis">
<h2><a name="windowssdk"></a>Windows SDK</h2>
<div cond="mightBeXp()" id="vis" class="quick">Quick: If you are using Windows XP or Windows Server 2003, skip this step.</div>

<div class="expl">
"The Windows SDK includes documentation, samples, and tools designed to help
you develop Windows applications and libraries using both Win32(R) and .NET
Framework ... technologies targeting Windows Vista," (<a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=C2B1E300-F358-4523-B479-F53D234CDCCF&displaylang=en">Microsoft</a>).
</div>

<ol>
  <li>
    <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=F26B1AA4-741A-433A-9BE5-FA919850BDBF&displaylang=en">Download</a> 
    the SDK.  As of Sept. 2008, version 6.1 was the current version.  Future 
    versions may require changing these instructions.
  </li>
   
  <li>
    Do a custom installation and check any options that have "x86" or "x64" in 
    them, unless you know you will not want to compile the library in 
    32-bit or 64-bit mode, respectively.  You can uncheck any .NET options if 
    you don't intend to use .NET (this library doesn't).
  </li>
    
  <li>Launch Visual Studio and load 
    <blockquote>
      <pre>C:\Program Files\Microsoft SDKs\Windows\v6.1\Samples\Multimedia\DirectShow\BaseClasses\baseclasses.sln</pre>
    </blockquote>
    Then using the menus,
    <ol type="a">
      <span cond="mightBeMat64()" id="vis">
        <li>Build &rarr; Configuration Manager... &rarr;
          <ol type="i">
            <li>Pull down the "Active solution platform:" selector and look for "x64".</li>
            <li>If it's already there, stop and jump to the batch build step below.  Otherwise, select "<tt>&lt;New...&gt;</tt>".</li>
            <li>In "Type or select the new platform:", select "x64".  </li>
          </ol>
        </li>
      </span>
      <li>
        Project &rarr; Base Classes Properties... &rarr; Configuration Properties &rarr;
        C/C++ &rarr; Language &rarr; 
        <ol type="i">
          <li>Pull down the "Configurations:" selector and pick "All Configurations".</li>
          <span cond="mightBeMat64()" id="vis">
            <li>Pull down the "Platform:" selector and pick "All Platforms".</li>
          </span>
          <li>Change the "Treat wchar_t as Built-in Type" to "No (/Zc:wchar_t-)". &nbsp;
              <i>Matlab was built with this option, so mex files and so must anything 
              they link to (including the library we're creating here)</i>.</li>
        </ol>
      </li>
      <li>
        Build &rarr; Batch Build... &rarr;
        <ol type="i"><li>Unless you know you will only be using some versions, select and
            build all of the configurations.</li></ol>
      </li>
    </ol>
  </li>
</ol>
</div>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<div cond="mightBeXp()" id="vis">
<h2><a name="platformsdk"></a>Platform SDK</h2>
<div class="quick">Quick: 
  <span cond="mightBeVista()" id="vis">If you are using Windows Vista, skip this step.</span>
  <span cond="mightBeXp()" id="vis">If you are using XP or Windows Server 2003, follow the instructions.</span>
</div>

<div class="expl">
  "The Platform SDK for Microsoft(R) Windows Server(R) 2003 R2 contains the 
  information and tools you need to develop Windows-based applications.  You 
  can use this SDK to develop both 32- and 64-bit applications,"
  (<a href="http://www.microsoft.com/downloads/details.aspx?familyid=0BAF2B35-C656-4969-ACE8-E4C0C0716ADB&displaylang=en">Microsoft</a>).
</div>

<ol>
  <li>
    <a href="http://www.microsoft.com/downloads/details.aspx?familyid=0BAF2B35-C656-4969-ACE8-E4C0C0716ADB&displaylang=en">Download</a>
    the SDK.  As of February 2008, R2 was the current version and it contains 
    important changes relative to R1 and earlier versions of the Platform SDK.  
    Unfortunately, most search engines (including Microsoft's) return a pre-R2 
    release as the first result.  Make sure you use R2 or later.  
  </li>
   
  <li>
    Do a standard install.  <span cond="mightBeMat64()" id="vis">If you would like
    64-bit support, check any options that have "x64" in them.</span>
  </li>
    
  <li>
    Run the following commands from the command prompt 
      (Start &rarr; Run... &rarr; type in "<tt>cmd.exe</tt>" without quotes):
    <blockquote>
<pre>set PATH="%PATH%;C:\Program Files\Microsoft Visual Studio 8\VC\bin"
cd "C:\Program Files\Microsoft Platform SDK for Windows Server 2003 R2\Samples\Multimedia\DirectShow\BaseClasses"
"C:\Program Files\Microsoft Visual Studio 8\VC\vcvarsall.bat"
set LIB=%LIB%;%LIB32%
nmake NODEBUG=1 _CRT_SECURE_NO_DEPRECATE=1</pre>    
    </blockquote>
    <p cond="mightBeVs2003()||mightBeVs2008()||mightBeMat64()" id="vis">
      If you are using a version of Visual Studio other than 2005 and/or if you
      are using a 64-bit operating system, adjust the aboves paths as
      appropriate.
    </p>
    <p cond="mightBeMat64()" id="vis">
      If you're building 64-bit versions, you will most likely need to add 
      "<tt>amd64</tt>" as a command-line argument to "<tt>vcvarsall.bat</tt>" and
      change "<tt>set LIB=%LIB%;%LIB32%</tt>" to "<tt>set LIB=%LIB%;%LIB64%</tt>".
      This is untested.
    </p>
    <p cond="mightBeVs2003()" id="vis">
      If you are using Visual Studio 2003, use <tt>vcvars32.bat</tt> instead of
      <tt>vcvarsall.bat</tt>.
    </p>
  </li>
</ol>
</div>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2><a name="dxsdk"></a>DirectX SDK</h2>
<div class="quick">Quick:  Download and install the DirectX SDK and tell 
  Visual Studio where the include and library files are.</div>

DirectX is a collection of multimedia APIs by Microsoft.  In order to read and
write a wide array of video files on Windows, we need to use DirectShow.  Some
of the files required for using DirectShow are found in the DirectX SDK.

<ol>
  <li>
    <a href="http://msdn.microsoft.com/directx/">Download</a> the latest 
    DirectX SDK.  Microsoft has historically released new versions every 3-6 
    months.  As of Sept. 2008, this download was nearly a half a gigabyte.  
  </li>

  <li>Install the SDK.  The default options are fine.</li>

  <li>
    See if the <tt>DXSDK_DIR</tt> system environment variable was created 
    (see the <a href="FAQ.txt">FAQ.txt</a> for instructions on viewing and 
    modifying environment variables).  If it was not created by the installer, 
    set <tt>DXSDK_DIR</tt> to 
    <blockquote>
      <pre>C:\Program Files<span cond="mightBeWin64()" id="vis"> (x86)</span>\Microsoft DirectX SDK (August 2008)</pre>
    </blockquote>
    (modify this directory to point to your SDK's base directory).
   </li>
</ol>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2><a name="building"></a>Building the Library</h2>
<div class="quick">Quick: Follow all of these instructions.</div>

We're now finally ready to build the library using Matlab.

<ol>
  <li>
    Start a <em>new</em> Matlab session.  You must relaunch Matlab so that it 
    can see the new values of the environment variables you have created and/or 
    modified.  Any time you modify environment variables used by Matlab (or 
    programs it calls), you must completely exit Matlab and restart it.
  </li>
   
  <li>
    In Matlab, run the following if you have not already done so:
    <blockquote><pre>mex -setup</pre></blockquote>
    Follow the on-screen instructions.  If you have multiple compilers 
    installed, choose the one that was configured in the 
    <a href="#vs">Visual Studio</a> section of this document.
  </li>
      
  <li>
    Edit the file
    <blockquote><pre>%APPDATA%\MathWorks\MATLAB\R2007b\mexopts.bat</pre></blockquote>
    replacing "<tt>R2007b</tt>" with your Matlab revision.  
    
    <ul>
      <span cond="mightBeVs2005()||mightBeVs2008()" id="vis">
        <li>
          on the <tt>COMPFLAGS</tt> line, add the following:
          <blockquote><pre>-D_CRT_SECURE_NO_DEPRECATE </pre></blockquote>
          This eliminates a number of spurious warning messages.
        </li>
      </span>
      <span cond="mightBeVs2005()||mightBeVs2008()" id="vis">
        <li>
          <span cond="mightBeVs2003()" id="vis">
            if using Visual Studio 2005 or 2008 (but not 2003), 
          </span>
          on the <tt>COMPFLAGS</tt> line, add the following:
          <blockquote><pre>/Zc:wchar_t-</pre></blockquote>
          This provides proper treatment of the character data type.
        </li>
      </span>
      <span cond="mightBeVs2003()" id="vis">
        <li>
          <span cond="mightBeVs2005()||mightBeVs2008()" id="vis">
            if using Visual Studio 2003, 
          </span>
          on the <tt>COMPFLAGS</tt> line, add the following:
          <blockquote><pre>/EHsc</pre></blockquote>
          This adds VS2003 exception support.
        </li>
      </span>
      <span cond="mightBeVs2003()" id="vis">
        <li>
          <span cond="mightBeVs2005()||mightBeVs2008()" id="vis">
            if using Visual Studio 2003, 
          </span>
          on the <tt>LINKFLAGS</tt> line, add the following:
          <blockquote><pre>/NODEFAULTLIB:LIBCMT.LIB</pre></blockquote>
          This fixes a VS2003 duplicate-linkage problem.
        </li>
      </span>
      <li>
        on the <tt>INCLUDE</tt> line, move 
        <blockquote><pre>%INCLUDE%</pre></blockquote>
        to the beginning of the list (it's at the end by default).  This corrects 
        for some interface changes Microsoft has made to its SDKs.  Make sure 
        there's a semicolon between "<tt>%INCLUDE%</tt>" and the next entry in the 
        list.
      </li>
      <span cond="mightBeMat32()" id="vis">
        <li>
          <span cond="mightBeMat64()" id="vis">if you are using 32-bit Matlab, </span>
          on the <tt>LIB</tt> line add
          <blockquote><pre>;%LIB32%</pre></blockquote>
          to the end of the line (with no whitespace).
        </li>  
      </span>
      <span cond="mightBeMat64()" id="vis">
        <li>
          <span cond="mightBeMat32()" id="vis">if you are using 64-bit Matlab, </span>
          on the <tt>LIB</tt> line add
          <blockquote><pre>;%LIB64%</pre></blockquote>
          to the end of the line (with no whitespace).
        </li>
      </span>
    </ul>
  </li>

  <li>
    In Matlab, go to the directory where you've placed the videoIO source files
    and run 
    <blockquote><pre>buildVideoIO</pre></blockquote>
  </li>
</ol>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2><a name="matpath"></a>Matlab Path</h2>
<div class="quick">Quick: add the installation directory to the Matlab path</div>

In Matlab add the base installation directory (but not all subdirectories) to
the path.  In the GUI this can be done by 
<blockquote>
  File &rarr; Set Path... &rarr; Add Folder...
</blockquote>
Alternatively, from the Matlab command line this can be done using the 
"<tt>addpath</tt>" and "<tt>savepath</tt>" functions.  

<p>Do <em>not</em> add directories recursively: the <tt>@videoReader/</tt>, 
<tt>@videoWriter/</tt>, and <tt>private/</tt> directories are handled 
automatically by Matlab's object system.  The <tt>tests/</tt> subdirectory 
contains files that are essentially private (e.g. a function named 
<tt>testAll</tt> could easily appear in other toolboxes or in the user's own 
code).  

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2><a name="testing"></a>Testing</h2>
<div class="quick">Quick: test the library</div>

<p>In Matlab, go to the <tt>tests/</tt> subdirectory and run <tt>testAll</tt>:</p>
<blockquote><pre><span style="color:green">% if this fails, you forgot to add the videoIO directory to your matlab path.</span>
cd(fullfile(videoIODir, 'tests')); 
<span style="color:green">
% This will take a long time (perhaps up to a few hours) to complete, but the 
% most basic and most critical tests are run first.  </span>
testAll 
</pre></blockquote>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
<h2><a name="usage"></a>Usage</h2>
<div class="quick">Quick: here are some pointers to getting started using the library</div>
See <a href="README.txt">README.txt</a> for a simple usage example.  
For user-level documentation, type any or all of the following at the Matlab 
prompt:
<br/><br/><blockquote><pre>
help buildVideoIO
help videoReader
help videoWriter
help videoread
</pre></blockquote>

<p>Also consider looking at <tt>tests/videoWriterDemo.m</tt> and 
<tt>tests/addFrameDemo.m</tt> for examples of writing videos.

</body>
</html>
